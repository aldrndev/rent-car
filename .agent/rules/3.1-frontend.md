# 3.1 â€” Frontend Rules

## Purpose

Define standards for frontend development using React ecosystem: Next.js, Vite, Tanstack, and supporting libraries.

## Stack (AUTHORITATIVE)

| Concern | Library | Notes |
|---------|---------|-------|
| Framework | Next.js or Vite + React | Next.js for SSR/SEO; Vite for SPA |
| Language | TypeScript (strict) | `any` FORBIDDEN |
| Server State | Tanstack Query (React Query) | ALL async data |
| Client State | Zustand | Slice-based stores |
| Routing (Vite) | Tanstack Router | Type-safe routing for Vite projects |
| Routing (Next.js) | App Router (built-in) | Use Next.js conventions |
| Forms | React Hook Form + Zod | Schema-first validation |
| Styling | Tailwind CSS | With semantic CSS variables |
| UI Primitives | Radix UI or shadcn/ui | Accessible, unstyled/styled primitives |
| Tables | Tanstack Table | For complex data tables |
| Validation | Zod | Source of truth for all schemas |
| HTTP Client | ky or fetch wrapper | Direct fetch calls FORBIDDEN |

### Library Selection Rules

- Direct `fetch()` calls in components FORBIDDEN â€” use Tanstack Query
- Global state for server data FORBIDDEN â€” use Tanstack Query
- CSS-in-JS runtime libraries FORBIDDEN (styled-components, emotion) â€” use Tailwind
- jQuery or DOM manipulation libraries FORBIDDEN
- Moment.js FORBIDDEN â€” use `date-fns` or `dayjs`

## Component Rules (ABSOLUTE)

- Max component size: 500 LOC â€” split if exceeded
- Error boundaries REQUIRED for route-level failures
- Suspense REQUIRED for lazy-loaded routes and async components
- Stable `key` props REQUIRED for lists
- Named exports ONLY â€” default exports FORBIDDEN (except Next.js pages where required)

### Component Structure

```typescript
// 1. Imports
import { useState } from 'react'

// 2. Types
interface UserCardProps {
  user: User
  onSelect: (id: string) => void
}

// 3. Component
export function UserCard({ user, onSelect }: UserCardProps) {
  // hooks first
  const [isExpanded, setIsExpanded] = useState(false)

  // handlers
  const handleClick = () => onSelect(user.id)

  // early returns for edge cases
  if (!user.isActive) return null

  // render
  return (...)
}
```

## Data Fetching â€” Tanstack Query (ABSOLUTE)

- Query keys MUST be stable and deterministic
- `initialData` shortcuts FORBIDDEN â€” use `placeholderData` if needed
- Manual refetch hacks FORBIDDEN â€” use `invalidateQueries`
- Mutations MUST invalidate relevant queries on success
- Retry MUST be bounded (max 3) â€” MUST NOT cause retry storms
- Loading and error states MUST be handled in UI
- ðŸŸ¡ Proper SSR hydration REQUIRED when using Next.js

### Query Key Convention

```typescript
// Use factory pattern for query keys
export const userKeys = {
  all: ['users'] as const,
  lists: () => [...userKeys.all, 'list'] as const,
  list: (filters: UserFilters) => [...userKeys.lists(), filters] as const,
  details: () => [...userKeys.all, 'detail'] as const,
  detail: (id: string) => [...userKeys.details(), id] as const,
}
```

## Client State â€” Zustand (AUTHORITATIVE)

- Slice-based stores REQUIRED
- Cross-slice direct imports FORBIDDEN â€” use store composition
- Derived state MUST be computed selectors (no duplicate truth)
- Server state in Zustand FORBIDDEN â€” use Tanstack Query

```typescript
// âœ… Good - slice-based store
interface AuthSlice {
  user: User | null
  setUser: (user: User | null) => void
}

export const useAuthStore = create<AuthSlice>((set) => ({
  user: null,
  setUser: (user) => set({ user }),
}))
```

## Routing â€” Tanstack Router (Vite Projects) (AUTHORITATIVE)

- File-based routing REQUIRED
- Type-safe route params REQUIRED
- Route validation with Zod REQUIRED for search params
- Pending/error states MUST be handled per route
- Code-splitting per route REQUIRED

## Forms (ABSOLUTE)

- React Hook Form REQUIRED for complex forms (3+ fields)
- Zod schema as source of truth REQUIRED
- Double-submit protection REQUIRED (disable button during submission)
- Submit handlers MUST be idempotent when possible

### User Feedback Rules

- `window.alert` / `confirm` / `prompt` FORBIDDEN
- Toast notifications: allowed sparingly for non-critical feedback
- Validation errors MUST be field-level (near the input)
- Submit errors MUST be section-level banners (near the form)
- Error messages MUST persist until resolved or dismissed
- Success messages MAY auto-dismiss (bounded duration)

## Styling â€” Tailwind CSS (AUTHORITATIVE)

- Tailwind with design tokens (CSS variables) REQUIRED
- Inline arbitrary values SHOULD be minimized â€” use theme config
- `!important` FORBIDDEN
- Component variants: use `class-variance-authority` (cva) or equivalent
- Responsive: mobile-first breakpoint approach

## UI Primitives â€” Radix / shadcn (AUTHORITATIVE)

- Radix UI or shadcn/ui as base primitives
- Prebuilt external UI kits FORBIDDEN unless team-owned
- Components MUST be accessible out of the box
- Customization via Tailwind classes / CSS variables

## Performance (AUTHORITATIVE)

- Avoid layout shift: CLS â‰¤ 0.1
- LCP â‰¤ 2.5s
- Code-splitting REQUIRED for non-critical routes
- Suspense MUST be used for lazy-loaded routes
- Images MUST use `next/image` (Next.js) or lazy loading (Vite)
- ðŸŸ¡ Bundle size SHOULD be budgeted and tracked

## SEO & i18n (WEB) (AUTHORITATIVE)

- Semantic HTML5 REQUIRED
- Single `<h1>` per page with proper heading hierarchy
- Meta tags: `title`, `description`, `og:*` REQUIRED
- ðŸŸ¡ i18n: use stable translation keys (not full sentences)
- ðŸŸ¡ Support ID + EN with auto-detect and fallback to EN

## Next.js Specific (AUTHORITATIVE)

- App Router preferred over Pages Router for new projects
- RSC caching MUST NOT be relied upon for correctness
- `loading.tsx` is lifecycle helper, not UX design
- Experimental flags MUST NOT define core behavior
- Server Actions: use for mutations, validate with Zod
- `"use client"` MUST be explicit and minimized

## Error Handling (ABSOLUTE)

- Error boundaries REQUIRED for route-level failures
- Global fallback UI MUST be accessible and informative
- User-visible errors MUST NOT leak internal details
- ðŸŸ¡ `requestId` SHOULD be shown in a copyable element for support
